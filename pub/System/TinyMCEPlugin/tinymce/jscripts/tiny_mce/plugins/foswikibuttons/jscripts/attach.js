var AttachDlg={preInit:function(){tinyMCEPopup.requireLangPack();},init:function(ed){var scripturl=FoswikiTiny.getFoswikiVar("SCRIPTURL");var suffix=FoswikiTiny.getFoswikiVar("SCRIPTSUFFIX");if(suffix==null)suffix='';var url=scripturl+"/rest"+suffix+"/WysiwygPlugin/attachments";var path=FoswikiTiny.getFoswikiVar("WEB")+'.'
+FoswikiTiny.getFoswikiVar("TOPIC");var params="nocache="+encodeURIComponent((new Date()).getTime())
+"&topic="+encodeURIComponent(path);tinymce.util.XHR.send({url:url+"?"+params,success:function(atts){if(atts!=null){atts=eval(atts);var select=document.getElementById("attachments_select");for(var i=0;i<atts.length;i++){select.options[i]=new Option(atts[i].name,atts[i].name);}}}});var el=document.getElementById('upload_form');el.action=scripturl+"/rest"+suffix+
"/WysiwygPlugin/upload";el=document.getElementById('upload_form_topic');el.value=path;tinyMCEPopup.resizeToInnerSize();},insertLink:function(){var inst=tinyMCE.activeEditor;var select=document.getElementById("attachments_select");var filename=select.value;var url=FoswikiTiny.getFoswikiVar("ATTACHURL")+'/'+filename;var tmp=filename.lastIndexOf(".");if(tmp>=0)
tmp=filename.substring(tmp+1,filename.length).toLowerCase();var html;if(tmp=="jpg"||tmp=="gif"||tmp=="jpeg"||tmp=="png"||tmp=="bmp"){html="<img src='"+url+"' alt='"+filename+"'>";}else{html="<a href='"+url+"'>"+filename+"</a>";}
inst.execCommand('mceInsertContent',false,html);inst.nodeChanged();tinyMCEPopup.close();}};AttachDlg.preInit();tinyMCEPopup.onInit.add(AttachDlg.init,AttachDlg);